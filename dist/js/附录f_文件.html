<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>文件 | 羊圈</title>
    <meta name="description" content="神羊的羊圈">
    <meta name="theme-color" content="#00adb5">
  <link rel="icon" href="/images/favicon.png">
  <meta itemprop="image" content="/js_tricks/images/favicon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#00adb5">
    
    <link rel="preload" href="/assets/css/0.styles.18cbf62c.css" as="style"><link rel="preload" href="/assets/js/app.c1618cf4.js" as="script"><link rel="preload" href="/assets/js/3.ed1bf183.js" as="script"><link rel="preload" href="/assets/js/92.686c84ef.js" as="script"><link rel="prefetch" href="/assets/js/1.b3385aaa.js"><link rel="prefetch" href="/assets/js/10.b526617f.js"><link rel="prefetch" href="/assets/js/100.9c76dc44.js"><link rel="prefetch" href="/assets/js/101.6b17334c.js"><link rel="prefetch" href="/assets/js/102.6072298e.js"><link rel="prefetch" href="/assets/js/103.8bf22d9c.js"><link rel="prefetch" href="/assets/js/104.da37280c.js"><link rel="prefetch" href="/assets/js/105.f6adc7cb.js"><link rel="prefetch" href="/assets/js/106.c479af52.js"><link rel="prefetch" href="/assets/js/107.7864a896.js"><link rel="prefetch" href="/assets/js/108.59251a56.js"><link rel="prefetch" href="/assets/js/109.401930b9.js"><link rel="prefetch" href="/assets/js/11.8c8a17aa.js"><link rel="prefetch" href="/assets/js/110.7f385c95.js"><link rel="prefetch" href="/assets/js/111.874ae40f.js"><link rel="prefetch" href="/assets/js/112.b88da53c.js"><link rel="prefetch" href="/assets/js/12.9a241d83.js"><link rel="prefetch" href="/assets/js/13.50f10eff.js"><link rel="prefetch" href="/assets/js/14.e6ebc69a.js"><link rel="prefetch" href="/assets/js/15.1145f768.js"><link rel="prefetch" href="/assets/js/16.8f53c91c.js"><link rel="prefetch" href="/assets/js/17.f5d33107.js"><link rel="prefetch" href="/assets/js/18.0fa172d4.js"><link rel="prefetch" href="/assets/js/19.b3ec819d.js"><link rel="prefetch" href="/assets/js/20.39dd808d.js"><link rel="prefetch" href="/assets/js/21.982519d1.js"><link rel="prefetch" href="/assets/js/22.e43852de.js"><link rel="prefetch" href="/assets/js/23.d20b98a1.js"><link rel="prefetch" href="/assets/js/24.8df2408b.js"><link rel="prefetch" href="/assets/js/25.6b7a2412.js"><link rel="prefetch" href="/assets/js/26.e0d54718.js"><link rel="prefetch" href="/assets/js/27.fa540f01.js"><link rel="prefetch" href="/assets/js/28.12872a08.js"><link rel="prefetch" href="/assets/js/29.a5357381.js"><link rel="prefetch" href="/assets/js/30.877d7c50.js"><link rel="prefetch" href="/assets/js/31.b4278efa.js"><link rel="prefetch" href="/assets/js/32.ebc68bbd.js"><link rel="prefetch" href="/assets/js/33.f08d05c9.js"><link rel="prefetch" href="/assets/js/34.a7d62a8e.js"><link rel="prefetch" href="/assets/js/35.f5d32a01.js"><link rel="prefetch" href="/assets/js/36.1ba48a2d.js"><link rel="prefetch" href="/assets/js/37.3e7062af.js"><link rel="prefetch" href="/assets/js/38.46a40d24.js"><link rel="prefetch" href="/assets/js/39.f11b85d4.js"><link rel="prefetch" href="/assets/js/4.1b01fc51.js"><link rel="prefetch" href="/assets/js/40.28ecd869.js"><link rel="prefetch" href="/assets/js/41.5e8bc3d9.js"><link rel="prefetch" href="/assets/js/42.ff6b4e3c.js"><link rel="prefetch" href="/assets/js/43.9a77ccd5.js"><link rel="prefetch" href="/assets/js/44.b54ec253.js"><link rel="prefetch" href="/assets/js/45.cbee26e2.js"><link rel="prefetch" href="/assets/js/46.5e19d09a.js"><link rel="prefetch" href="/assets/js/47.0acc679f.js"><link rel="prefetch" href="/assets/js/48.bfdd685b.js"><link rel="prefetch" href="/assets/js/49.e42f572c.js"><link rel="prefetch" href="/assets/js/5.d587daef.js"><link rel="prefetch" href="/assets/js/50.85bfbfcd.js"><link rel="prefetch" href="/assets/js/51.576a7373.js"><link rel="prefetch" href="/assets/js/52.f26ffee5.js"><link rel="prefetch" href="/assets/js/53.163cf701.js"><link rel="prefetch" href="/assets/js/54.c1132ecc.js"><link rel="prefetch" href="/assets/js/55.e089f0d4.js"><link rel="prefetch" href="/assets/js/56.be59a8ef.js"><link rel="prefetch" href="/assets/js/57.a015f201.js"><link rel="prefetch" href="/assets/js/58.0235e47f.js"><link rel="prefetch" href="/assets/js/59.0b6f5acf.js"><link rel="prefetch" href="/assets/js/6.69e07e2c.js"><link rel="prefetch" href="/assets/js/60.641c2f95.js"><link rel="prefetch" href="/assets/js/61.17b03fa8.js"><link rel="prefetch" href="/assets/js/62.96134956.js"><link rel="prefetch" href="/assets/js/63.f845d120.js"><link rel="prefetch" href="/assets/js/64.e9ed93d9.js"><link rel="prefetch" href="/assets/js/65.2bd53147.js"><link rel="prefetch" href="/assets/js/66.1f03bf79.js"><link rel="prefetch" href="/assets/js/67.47eb30d1.js"><link rel="prefetch" href="/assets/js/68.cc339c5a.js"><link rel="prefetch" href="/assets/js/69.2ff09789.js"><link rel="prefetch" href="/assets/js/7.3199f861.js"><link rel="prefetch" href="/assets/js/70.9d03d949.js"><link rel="prefetch" href="/assets/js/71.7eab78cd.js"><link rel="prefetch" href="/assets/js/72.20dd5f6e.js"><link rel="prefetch" href="/assets/js/73.6c6af6b0.js"><link rel="prefetch" href="/assets/js/74.8eed043b.js"><link rel="prefetch" href="/assets/js/75.3b5158cd.js"><link rel="prefetch" href="/assets/js/76.0eacd2d9.js"><link rel="prefetch" href="/assets/js/77.c3ba3709.js"><link rel="prefetch" href="/assets/js/78.843656e9.js"><link rel="prefetch" href="/assets/js/79.99bae0b9.js"><link rel="prefetch" href="/assets/js/8.8d4fcdde.js"><link rel="prefetch" href="/assets/js/80.4d3c67b0.js"><link rel="prefetch" href="/assets/js/81.85eaf0e7.js"><link rel="prefetch" href="/assets/js/82.27feb7aa.js"><link rel="prefetch" href="/assets/js/83.7686c618.js"><link rel="prefetch" href="/assets/js/84.941fa5d5.js"><link rel="prefetch" href="/assets/js/85.46a4182a.js"><link rel="prefetch" href="/assets/js/86.1d2fa06f.js"><link rel="prefetch" href="/assets/js/87.1fa71add.js"><link rel="prefetch" href="/assets/js/88.a9a069f0.js"><link rel="prefetch" href="/assets/js/89.93d73858.js"><link rel="prefetch" href="/assets/js/9.99351bd6.js"><link rel="prefetch" href="/assets/js/90.029a12be.js"><link rel="prefetch" href="/assets/js/91.669f4475.js"><link rel="prefetch" href="/assets/js/93.47bd8585.js"><link rel="prefetch" href="/assets/js/94.0b908759.js"><link rel="prefetch" href="/assets/js/95.f4d85cb9.js"><link rel="prefetch" href="/assets/js/96.e57f6246.js"><link rel="prefetch" href="/assets/js/97.b5660771.js"><link rel="prefetch" href="/assets/js/98.91198c9e.js"><link rel="prefetch" href="/assets/js/99.9a6c1efc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.18cbf62c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">羊圈</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">blog</a></div><div class="nav-item"><a href="https://qishaoxuan.github.io/animate_resume/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  about me
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">blog</a></div><div class="nav-item"><a href="https://qishaoxuan.github.io/animate_resume/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  about me
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/1.基础知识.html" class="sidebar-link">基础知识</a></li><li><a href="/js/2.数据类型.html" class="sidebar-link">数据类型</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="文件">文件</h1> <h2 id="上传">上传</h2> <p>文件上传的几种方式：</p> <ul><li>传统 flash 上传</li> <li>隐藏 iframe 框上传</li> <li>表单数据提交</li> <li>HTML5 的新工具——File API</li></ul> <h3 id="form-表单上传">form 表单上传</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;upload&quot;</span> method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span> enctype<span class="token operator">=</span><span class="token string">&quot;multipart/form-data&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;pic&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;上传&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
</code></pre></div><ul><li><code>action</code> 请求的后端方法</li> <li><code>enctype=&quot;multipart/form-data</code> 在使用包含文件上传控件的表单时，必须使用该值。</li></ul> <h3 id="formdata-上传">FormData 上传</h3> <p>form 表单提交会导致页面刷新，不希望页面被刷新，可以用 ajax 上传 FormData 数据。</p> <blockquote><p>XMLHttpRequest Level 2 添加了一个新的接口 FormData，利用 FormData 对象，我们可以通过 JavaScript 用一些键值对来模拟一系列表单控件，我们还可以使用 XMLHttpRequest 的 send()方法来异步的提交。比起普通的 ajax，使用 FormData 的最大优点就是我们可以异步上传一个二进制文件。</p></blockquote> <p>参见：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/API/FormData<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>form<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;pic&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;pic&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> onClick<span class="token operator">=</span><span class="token string">&quot;upload()&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;上传&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> url<span class="token operator">=</span><span class="token string">&quot;upload&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取文件</span>
  <span class="token keyword">let</span> pic <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'pic'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 初始化一个 XMLHttpRequest 对象</span>
  <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 初始化一个 FormData 对象</span>
  <span class="token keyword">var</span> form <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 携带文件</span>
  form<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;pic&quot;</span><span class="token punctuation">,</span> pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//开始上传</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//在readystatechange事件上绑定一个事件处理函数</span>
  xhr<span class="token punctuation">.</span>onreadystatechange<span class="token operator">=</span>callback<span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>参见:<a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/Using_FormData_Objects" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/Guide/Using_FormData_Objects<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="file-api">File API</h3> <p>File 对象可以用来获取某个文件，还可以读取这个文件的内容。通常情况下，File 对象是来自用户在一个<code>&lt;input&gt;</code>元素上选择文件后返回的<code>FileList</code>对象,也可以是来自由拖放操作生成的 DataTransfer 对象。</p> <h3 id="input-上传">input 上传</h3> <p>我们可以通过给 input file 标签设置 accept 属性进行文件选择过滤，该属性的值必须为一个逗号分割的列表,包含了多个唯一的内容类型声明：</p> <ul><li>以 STOP 字符 (U+002E) 开始的文件扩展名。（例如：&quot;.jpg,.png,.doc&quot;）</li> <li>一个有效的 MIME 类型，但没有扩展名</li> <li>audio/* 表示音频文件 HTML5</li> <li>video/* 表示视频文件 HTML5</li> <li>image/* 表示图片文件</li></ul> <p>设置 multiple 属性可以进行设置为多选。</p> <p>设置 capture 属性可以进行设置打开摄像拍照或者录像。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- Capture Image: --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image/*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">capture</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>camera<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- Capture Audio: --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>audio/*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">capture</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>microphone<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- Capture Video: --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video/*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">capture</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>camcorder<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>multiple 属性和 capture 属性不能同时生效。</p> <p>通过 File API,我们可以在用户选取一个或者多个文件之后,访问到代表了所选文件的一个或多个 File 对象，这些对象被包含在一个 FileList 对象中。所有 type 属性(attribute)为 file 的<code>&lt;input&gt;</code>元素都有一个 files 属性，用来存储用户所选择的文件。files 有一个 length 属性和 item 方法，我们可以通过 files[index]或者 files.item(index)获取我们选择的 file 对象。可以通过 change 事件监听 input file 输入完成事件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fileInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;fileInput&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> file <span class="token operator">=</span> fileInput<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 或file = fileInput.files.item(0);</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>File API 提供 File 对象，它是 FileList 对象的成员，包含了文件的一些元信息，比如文件名、上次改动时间、文件大小和文件类型。下图可以 File 对象的属性：</p> <p><img src="https://segmentfault.com/img/bVBRlF?w=765&amp;h=146" alt="clipboard.png"></p> <ul><li>lastModifiedDate：文件对象最后修改的日期</li> <li>name：文件名,只读字符串,不包含任何路径信息.</li> <li>size：文件大小,单位为字节,只读的 64 位整数.</li> <li>type：MIME 类型,只读字符串,如果类型未知,则返回空字符串.</li></ul> <p>例如：我们可以根据 size 换算出我们习惯的文件大小表达方式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 读文件大小
 * @param {Object} file
 */</span>
<span class="token keyword">function</span> <span class="token function">readFileSize</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> size <span class="token operator">=</span> file<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> aMultiples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;KB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ZB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;YB&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> fileSizeString <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> size <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span> size <span class="token operator">/=</span> <span class="token number">1024</span><span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fileSizeString <span class="token operator">=</span> size<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> aMultiples<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> fileSizeString<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>有时候我们希望限制用户上传的文件大小，可以通过这个方法先做判断。同时我们可以通过 type 属性判断用户的文件类型，但是这种方法不可靠，因为用户可以通过改变后缀名实现。</p> <p>通过 input file 标签获得文件完整路径，由于浏览器安全机制，这个是不被允许的，但是有时候我们希望选择完图片预览一下图片，这个时候我们就可以用 FileReader API 实现。</p> <h2 id="filereader-api">FileReader API</h2> <blockquote><p>使用 FileReader 对象,web 应用程序可以异步的读取存储在用户计算机上的文件(或者原始数据缓冲)内容,可以使用 File 对象或者 Blob 对象来指定所要处理的文件或数据.其中 File 对象可以是来自用户在一个<input>元素上选择文件后返回的 FileList 对象,也可以来自拖放操作生成的 DataTransfer 对象,还可以是来自在一个 HTMLCanvasElement 上执行 mozGetAsFile()方法后的返回结果。</p></blockquote> <h3 id="datauri-对象">DataURI 对象</h3> <p>在上面通过拖放操作选择文件的例子中，我们使用了&quot;data:image/png;base64,xxxxxxxxxxxxx&quot;这种形式的字符串作为背景，而不是图片，选择的图片展示也是使用这种形式。这种字符串叫做 DataURI 对象，允许将一个小文件进行编码后嵌入到另外一个文档里，格式为：</p> <div class="language- extra-class"><pre class="language-text"><code>data:[&lt;MIME type&gt;][;charset=&lt;charset&gt;][;base64],&lt;encoded data&gt;
</code></pre></div><p>整体可以视为三部分，即声明：参数+数据，逗号左边的是各种参数，右边的是数据。</p> <p>URL 是 uniform resource locator 的缩写，在 web 中的每一个可访问资源都有一个 URL 地址，例如图片，HTML 文件，js 文件以及 style sheet 文件，我们可以通过这个地址去 download 这个资源。其实 URL 是 URI 的子集，URI 是 uniform resource identifier 的缩写。URI 是用于获取资源，包括其附加的信息的一种协议。附加信息可能是地址，也可能不是地址，如果是地址，那么这时 URI 就变成 URL 了。注意的是 data URI 不是 URL，因为它并不包含资源的公共地址。</p> <p>我们可以通过 FileReader 的 readAsDataURL 方法获得：</p> <div class="language- extra-class"><pre class="language-text"><code>var reader = new FileReader();
reader.onload = function() {
    console.log(this.result);
}
reader.readAsDataURL(file);
</code></pre></div><p>有时候我们需要将 DataURI 对象转 blob 对象：</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * dataURI 转 blob
 * @param {Object} dataURI
 */
function dataURItoBlob(dataURI) {
    var arr = dataURI.split(','), mime = arr[0].match(/:(.*?);/)[1],
    bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
    while(n--){
        u8arr[n] = bstr.charCodeAt(n);
    }
    return new Blob([u8arr], {type:mime});
}
</code></pre></div><h3 id="url-对象">URL 对象</h3> <p>我们除了可以使用 base64 字符串作为内容的 DataURI 将一个文件嵌入到另外一个文档里，还可以使用 URL 对象。URL 对象用于生成指向 File 对象或 Blob 对象的 URL。</p> <blockquote><p>window.URL.createObjectURL</p></blockquote> <p>静态方法会创建一个 DOMString，它的 URL 表示参数中的对象。这个 URL 的生命周期和创建它的窗口中的 document 绑定。这个新的 URL 对象表示着指定的 File 对象或者 Blob 对象。</p> <div class="language- extra-class"><pre class="language-text"><code>var objecturl =  window.URL.createObjectURL(file);
</code></pre></div><blockquote><p>window.URL.revokeObjectURL</p></blockquote> <p>静态方法用来释放一个之前通过调用 window.URL.createObjectURL() 创建的已经存在的 URL 对象。当你结束使用某个 URL 对象时，应该通过调用这个方法来让浏览器知道不再需要保持这个文件的引用了。</p> <div class="language- extra-class"><pre class="language-text"><code>window.URL.revokeObjectURL(objecturl)
</code></pre></div><p>例如：使用对象 URL 来显示图片：</p> <div class="language- extra-class"><pre class="language-text"><code>window.URL = window.URL || window.webkitURL;

var img = document.createElement(&quot;img&quot;);
img.src = window.URL.createObjectURL(blob);
img.height = 60;
img.onload = function(e) {
  window.URL.revokeObjectURL(this.src);
}
document.body.appendChild(img);
</code></pre></div><h3 id="filereader-api-详解">FileReader API 详解</h3> <h4 id="状态常量">状态常量</h4> <ul><li><strong>EMPTY</strong>：值为 0，还没有加载任何数据;</li> <li><strong>LOADING</strong>：值为 1，数据正在被加载;</li> <li><strong>DONE</strong>：值为 2，已完成全部的读取请求。</li></ul> <h4 id="属性">属性</h4> <ul><li><strong>error</strong>：在读取文件时发生的错误， 只读;</li> <li><strong>readyState</strong>：表明 FileReader 对象的当前状态，值为 State constants 中的一个，只读；</li> <li><strong>result</strong>：取到的文件内容，这个属性只在读取操作完成之后才有效,并且数据的格式取决于读取操作是由哪个方法发起的，只读。</li></ul> <h4 id="方法">方法</h4> <ul><li><strong>abort()</strong>：中止该读取操作.在返回时,readyState 属性的值为 DONE.</li> <li><strong>readAsArrayBuffer()</strong>：开始读取指定的 Blob 对象或 File 对象中的内容. 当读取操作完成时,readyState 属性的值会成为 DONE,如果设置了 onloadend 事件处理程序,则调用之.同时,result 属性中将包含一个 ArrayBuffer 对象以表示所读取文件的内容.</li> <li><strong>readAsBinaryString()</strong>：开始读取指定的 Blob 对象或 File 对象中的内容. 当读取操作完成时,readyState 属性的值会成为 DONE,如果设置了 onloadend 事件处理程序,则调用之.同时,result 属性中将包含所读取文件的原始二进制数据.</li> <li><strong>readAsDataURL()</strong>：开始读取指定的 Blob 对象或 File 对象中的内容. 当读取操作完成时,readyState 属性的值会成为 DONE,如果设置了 onloadend 事件处理程序,则调用之.同时,result 属性中将包含一个 data: URL 格式的字符串以表示所读取文件的内容.</li> <li><strong>readAsText()</strong>：开始读取指定的 Blob 对象或 File 对象中的内容. 当读取操作完成时,readyState 属性的值会成为 DONE,如果设置了 onloadend 事件处理程序,则调用之.同时,result 属性中将包含一个字符串以表示所读取的文件内容.</li></ul> <h4 id="事件处理">事件处理</h4> <ul><li><strong>onabort</strong>：当读取操作被中止时调用.</li> <li><strong>onerror</strong>：当读取操作发生错误时调用.</li> <li><strong>onload</strong>：当读取操作成功完成时调用.</li> <li><strong>onloadend</strong>：当读取操作完成时调用,不管是成功还是失败.该处理程序在 onload 或者 onerror 之后调用.</li> <li><strong>onloadstart</strong>：当读取操作将要开始之前调用.</li> <li><strong>onprogress</strong>：在读取数据过程中周期性调用.</li></ul> <p><strong>上传实例</strong>：以二进制流上传文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fileInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;fileInput&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileInput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> file <span class="token operator">=</span> fileInput<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> percentage <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>loaded <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> e<span class="token punctuation">.</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;percentage:&quot;</span> <span class="token operator">+</span> percentage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;percentage:100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;这里填写服务器地址&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsBinaryString</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="blob-二进制大对象">blob 二进制大对象</h2> <p>BLOB (binary large object)，二进制大对象，是一个可以存储二进制文件的容器。</p> <blockquote><p>创建 Blob 对象的方法有几种，可以调用 Blob 构造函数，还可以使用一个已有 Blob 对象上的 slice()方法切出另一个 Blob 对象，还可以调用 canvas 对象上的 toBlob 方法。</p></blockquote> <p>第一次见到这个词是半年之前，那个时候居然没有听过 blob，然后上网查了一下，巴拉巴拉一大堆，当时是不理解的。</p> <p>看了前面的一系列 API 和对象，或许很多同学开始晕了，但是在一开始说到的 blob 对象，我们一直没有提到，如果本文不提及，显然是不合理的。毕竟作为 File 对象的爸爸，blob 劳苦功高。上述的 FileReader 对象也可以操作 blob 对象。</p> <p>Blob 对象有两个只读属性：</p> <ul><li>size：二进制数据的大小，单位为字节。</li> <li>type：二进制数据的 MIME 类型，全部为小写，如果类型未知，则该值为空字符串。
在 Ajax 操作中，如果 xhr.responseType 设为 blob，接收的就是二进制数据。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 计算文件大小
 * @param {Object} file
 */</span>
<span class="token keyword">function</span> <span class="token function">readFileSize</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> size <span class="token operator">=</span> file<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> aMultiples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;KB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ZB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;YB&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> fileSizeString <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> size <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span> size <span class="token operator">/=</span> <span class="token number">1024</span><span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fileSizeString <span class="token operator">=</span> size<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> aMultiples<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> fileSizeString<span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="blob-构造函数生成-blob-对象">Blob 构造函数生成 blob 对象</h3> <p>Blob 构造函数，接受两个参数。第一个参数是一个包含实际数据的数组，第二个参数是数据的类型，这两个参数都不是必需的。数组元素可以是任意多个的 ArrayBuffer，ArrayBufferView
(typed array)， Blob，或者 DOMString 对象。
例如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;h1&gt;hello world&lt;/h1&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&quot;text/xml&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// the blob</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>效果如下：</p> <p><img src="https://segmentfault.com/img/bVBRmh?w=401&amp;h=63" alt="clipboard.png"></p> <h4 id="用-js-在浏览器中创建下载文件">用 JS 在浏览器中创建下载文件</h4> <p>前端很多项目中，都有文件下载的需求，特别是 JS 生成文件内容，然后让浏览器执行下载操作（例如在线图片编辑、在线代码编辑、iPresst 等）但受限于浏览器，很多情况下我们都只能给出个链接，让用户点击打开-》另存为。如下面这个链接：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>file.js<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>用户点击这个链接的时候，浏览器会打开并显示链接指向的文件内容，显然，这并没有实现我们的需求。HTML5 中给 a 标签增加了一个 download 属性，只要有这个属性，点击这个链接时浏览器就不在打开链接指向的文件，而是改为下载（目前只有 chrome、firefox 和 opera 支持）。下载时会直接使用链接的名字来作为文件名，但是是可以改的，只要给 download 加上想要的文件名即可，如：<code>download=&quot;not-a-file.js&quot;</code>。但是这样还不够，以上的方法只适合用在文件是在服务器上的情况。如果在浏览器端 js 生成的内容，想让浏览器进行下载要如何办到呢？DataURI 可以实现这个效果，但是 DataURI 的文件类型被限制了，我们这里可以变通一下实现 blob 对象。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>aLink<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> aLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    aLink<span class="token punctuation">.</span>download <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
    aLink<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#aLink&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token string">&quot;#aLink&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;h1&gt;hello world&lt;/h1&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="blob-对象的-slice-方法生成-blob-对象">Blob 对象的 slice 方法生成 blob 对象</h3> <p>Blob 对象的 slice 方法，将二进制数据按照字节分块，返回一个新的 Blob 对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> newBlob <span class="token operator">=</span> oldBlob<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>startingByte<span class="token punctuation">,</span> endindByte<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下面是一个使用 XMLHttpRequest 对象，将大文件分割上传的例子。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token parameter">blobOrFile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'/server'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>blobOrFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;file&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token constant">BYTES_PER_CHUNK</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">// 1MB chunk sizes.</span>
  <span class="token keyword">const</span> <span class="token constant">SIZE</span> <span class="token operator">=</span> blob<span class="token punctuation">.</span>size<span class="token punctuation">;</span>

  <span class="token keyword">var</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> end <span class="token operator">=</span> <span class="token constant">BYTES_PER_CHUNK</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span><span class="token punctuation">(</span>start <span class="token operator">&lt;</span> <span class="token constant">SIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">upload</span><span class="token punctuation">(</span>blob<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    start <span class="token operator">=</span> end<span class="token punctuation">;</span>
    end <span class="token operator">=</span> start <span class="token operator">+</span> <span class="token constant">BYTES_PER_CHUNK</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="下载">下载</h2> <h3 id="a-标签下载">a 标签下载</h3> <p>对于图片文件和文本文件这种可以被浏览器打开的文件不会被下载</p> <h3 id="dataurl和bloburl">DataUrl和BlobUrl</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>DataUrl
 <span class="token comment">// ./util.js</span>
 <span class="token comment">// 图片转base64</span>
 <span class="token keyword">function</span> <span class="token function">image2base64</span><span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> img<span class="token punctuation">.</span>width<span class="token punctuation">;</span>  
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> img<span class="token punctuation">.</span>height<span class="token punctuation">;</span>  
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>width<span class="token punctuation">,</span> img<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">const</span> mime <span class="token operator">=</span> img<span class="token punctuation">.</span>src<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>src<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">const</span> dataUrl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">&quot;image/&quot;</span> <span class="token operator">+</span> mime<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">return</span> dataUrl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;crossOrigin&quot;</span><span class="token punctuation">,</span><span class="token string">'Anonymous'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'../files/test-download.png'</span> <span class="token operator">+</span> <span class="token string">'?'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">const</span> imageDataUrl <span class="token operator">=</span> <span class="token function">image2base64</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">const</span> downloadDataUrlDom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'downloadDataUrl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  downloadDataUrlDom<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">,</span> imageDataUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  downloadDataUrlDom<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'download'</span><span class="token punctuation">,</span> <span class="token string">'download-data-url.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  downloadDataUrlDom<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'下载文件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="excel">excel</h2> <h3 id="csv">csv</h3> <p>csv 结构简单</p> <h2 id="xlsx">xlsx</h2> <p>借助 xlsx 插件，前端可以生成 .xlsx 文件进行导出</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><div class="cat-container" data-v-a13867c0><canvas id="vuepress-cat" width="280" height="250" class="live2d" data-v-a13867c0></canvas></div></div></div>
    <script src="/assets/js/app.c1618cf4.js" defer></script><script src="/assets/js/3.ed1bf183.js" defer></script><script src="/assets/js/92.686c84ef.js" defer></script>
  </body>
</html>
