(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{337:function(s,a,t){"use strict";t.r(a);var r=t(9),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("有时候 laravel 会出现无权限写日志的问题，我们可以按以下步骤去检查：")]),s._v(" "),t("p",[s._v("运行 laravel 的 php-fpm 是什么用户，一般是 www，最好不要使用 root。\n应用目录中，storage/logs 有没有写权限。\n是否有运行 laravel 的脚本或者 crontab，或者supervisor，并且运行的用户和 php-fpm 的是一样的，一般是www。如果以其他身份（例如root）运行的时候 laravel 需要写日志并且创建了日志文件，那这个日志文件是属于其他用户的，www 用户无法写入。\n解决办法")]),s._v(" "),t("p",[s._v("修改 php-fpm 的配置文件，修改 user 和 group 为 www。\nchmod a+w storage/logs\n运行 php artisan 时 su www &，crontab 添加执行用户 * www command")]),s._v(" "),t("p",[s._v("日志权限的问题基本是出现在有使用 artisan 执行定时任务的情况下。查看日志文件的权限时发现，处理 Web 请求时的日志的用户为 nobody。")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("$ ls "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12508")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("67680")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v(" laravel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.")]),s._v("log\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("74680")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v(" laravel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.")]),s._v("log\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("74680")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v(" laravel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.")]),s._v("log\n")])])]),t("p",[s._v("后来查了一下，使用 crontab 执行定时任务时，默认用户是 root，root 用户生成的文件，nobody 用户自然没有权限进行处理，出问题也就不奇怪了。又查了一下，使用 crontab 编辑定时任务列表的时候，是可以指定用户的，默认是编辑 root 用户的任务列表。")]),s._v(" "),t("blockquote",[t("p",[s._v("执行 "),t("code",[s._v("crontab -e")]),s._v(" 的时候添加 "),t("code",[s._v("-u")]),s._v(" 选项，并追加相应的用户名，就可以为指定的用户编辑定时任务列表。")])]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("$ crontab "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u nobody "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" edit the command you want to execute "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user nobody\n")])])]),t("blockquote",[t("p",[s._v("执行 "),t("code",[s._v("crontab -u nobody -l")]),s._v(" 选项可以查看 nobody 用户的任务列表。")])]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("$ crontab "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u nobody "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" command one "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user nobody\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" command two "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user nobody\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);