# 缓存

## 缓存机制

请求最终处理方式：

1. Service Worker
2. Memory Cache
3. Disk Cache
4. Push Cache（HTTP/2，只在会话（Session）中存在，一旦会话结束就被释放）
5. 网络请求

### 缓存

- 即便缓存服务器（客户端浏览器）内有缓存文件，也不能保证每次都会使用到对应资源的缓存，这和被缓存资源的有效性有关
- 列如客户端的要求，缓存的有效期等
- 当遇上源服务器上的资源更新时，如果还是使用不变的缓存，那就演变成返回更新前的旧资源了

### 强缓存

- Expires：服务端将资源失效的日期告知客户端，首部字段 cache-control 有指定 max-age 指令时，比起首部字段 Expires，会优先处理 max-age 指令
- cache-control（http 1.1）：

  - max-age[秒] | 响应的最大 age 值
  - no-cache | 缓存前必须先确认其有效性
  - no-store | 不缓存请求或响应的任何内容

### 协商缓存

- last-modified（响应）& 请求首部字段 if-modified-since

  - last-modified：服务器在响应请求时，会告诉浏览器资源的最后修改时间
  - if-modified-since：浏览器再次请求服务器的时候，请求头会包含此字段，后面跟着在缓存中获得的最后修改时间。服务端收到此请求头发现有if-Modified-Since，则与被请求资源的最后修改时间进行对比，如果一致则返回304和响应报文头，浏览器只需要从缓存中获取信息即可。

  第一次请求资源时，资源在响应头中种入 last-modified 字段，并随着响应体一起存到缓存中


- etag & 请求首部字段 if-None-Match
  -  etag：服务器响应请求时，通过此字段告诉浏览器当前资源在服务器生成的唯一标识（生成规则由服务器决定）
  - if-None-Match：再次请求服务器时，浏览器的请求报文头部会包含此字段，后面的值为在缓存中获取的标识。服务器接收到次报文后发现If-None-Match则与被请求资源的唯一标识进行对比。

# Meta httpEquiv 属性

httpEquiv 属性把 content 属性连接到 HTTP 头部。

`metaObject.httpEquiv=content-type|expires|refresh|set-cookie`

```html
<meta http-equiv="refresh" content="5" />
```

一些常用的 _HTTP-header_ 值:

| 值               | 描述                                                                                                                                                                                                                                                                            |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| cache-control    | 控制文档的缓存机制。允许的值：public - 所有内容都将被缓存(客户端和代理服务器都可缓存)private - 内容只缓存到私有缓存中(仅客户端可以缓存，代理服务器不可缓存)no-cache - 不缓存 no-store - 缓存当不归档 but not archived 实例:<meta http-equiv="cache-control" content="no-cache"> |
| content-language | 响应体的语言实例:<meta http-equiv="content-language" content="en-US">                                                                                                                                                                                                           |
| content-type     | 返回内容的 MIME 类型**提示:** 通常用于字符集的设置。实例:<meta http-equiv="content-type" content="text/html; charset=UTF-8">                                                                                                                                                    |
| date             | 原始服务器消息发出的时间实例:<meta http-equiv="date" content="Wed, 16 Feb 2011 22:34:13 GMT">                                                                                                                                                                                   |
| expires          | 响应过期的日期和时间实例:<meta http-equiv="expires" content="Fri, 30 Dec 2011 12:00:00 GMT">                                                                                                                                                                                    |
| last-modified    | 请求资源的最后修改时间实例:<meta http-equiv="last-modified" content="Mon, 03 Jan 2011 17:45:57 GMT">                                                                                                                                                                            |
| location         | 用来重定向接收方到非请求 URL 的位置来完成请求或标识新的资源实例:<meta http-equiv="location" content="URL=http://www.runoob.com">                                                                                                                                                |
| refresh          | 定义间隔多久后刷新页面。实例:<meta http-equiv="refresh" content="300">                                                                                                                                                                                                          |
| set-cookie       | 创建一个 cookie ，包含了 cookie 名，cookie 值，过期时间。实例:<meta http-equiv="set-cookie" content="runoobcookie=myContent;expires=Fri, 30 Dec 2015 12:00:00 GMT; path=http://www.runoob.com">                                                                                 |
| window-target    | 指定要载入的框架名                                                                                                                                                                                                                                                              |


